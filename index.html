<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alpha Terminal v41.5 | Predator Insight</title>
    <style>
        :root { --bg: #0b0e11; --card: #161a1e; --border: #2b2f36; --bull: #00ffad; --bear: #ff3b30; --accent: #58a6ff; --gold: #f0b90b; }
        body { background: var(--bg); color: #eaecef; font-family: 'Inter', sans-serif; margin: 0; padding: 4px; font-size: 10px; }
        .dashboard { display: grid; grid-template-columns: 1fr; gap: 8px; height: auto; }
        
        @media (min-width: 1024px) {
            .dashboard { grid-template-columns: 240px 1fr 300px; grid-template-rows: 600px 400px; height: 98vh; }
            .card-chart { grid-column: 2; grid-row: 1; }
            .card-table { grid-column: 2 / 4; grid-row: 2; }
        }

        .card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; display: flex; flex-direction: column; overflow: hidden; }
        .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-top: 10px; }
        .monitor-table { width: 100%; min-width: 1200px; border-collapse: collapse; text-align: left; }
        .monitor-table th { color: #848e9c; font-size: 9px; padding: 8px 4px; border-bottom: 1px solid var(--border); }
        .monitor-table td { padding: 10px 4px; border-bottom: 1px solid #1c2026; font-family: 'Roboto Mono', monospace; font-size: 10px; vertical-align: middle; }

        .trend-meter { width: 40px; height: 4px; background: #333; border-radius: 2px; display: inline-block; }
        .trend-fill { height: 100%; border-radius: 2px; }
        .rsi-tag { font-size: 9px; padding: 2px 4px; border-radius: 3px; background: #222; margin-left: 5px;}
        .wl-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #222; cursor: pointer; }
        input { background: #0b0e11; border: 1px solid #444; color: white; padding: 10px; border-radius: 4px; width: 100%; box-sizing: border-box; }
        .btn-add { background: var(--accent); border: none; color: white; padding: 10px; border-radius: 4px; cursor: pointer; margin-top: 8px; font-weight: bold; }
        .reasoning { color: #848e9c; font-style: italic; font-size: 9px; line-height: 1.2; }
    </style>
</head>
<body>
<div class="dashboard">
    <div class="card card-wl">
        <h3>‚≠ê WATCHLIST</h3>
        <input type="text" id="newT" placeholder="Symbol (e.g. SOL)">
        <button class="btn-add" onclick="addTicker()">ADD ASSET</button>
        <div id="wl-cont" class="table-wrapper"></div>
    </div>

    <div class="card card-chart" style="padding:0; border:none;">
        <div id="tv_chart_container" style="height: 100%; min-height: 400px;"></div>
    </div>

    <div class="card">
        <h3>üì° FEED</h3>
        <iframe src="https://cryptopanic.com/widgets/news/?bg_color=161A1E&text_color=EAECEF" width="100%" height="100%" frameborder="0"></iframe>
    </div>

    <div class="card card-table">
        <h3>üìä PREDATOR ALPHA TABLE (v41.5)</h3>
        <div class="table-wrapper">
            <table class="monitor-table">
                <thead>
                    <tr>
                        <th>TICKER</th><th>PRICE</th><th>TREND</th><th>SUP / RES</th><th>SQZ</th><th>SENTIMENT</th><th>DIVERGENCE</th><th>VOL SHOCK</th><th>WHALE</th><th>AI SIGNAL</th><th>HEADS-UP</th><th>REASONING / CONTEXT</th>
                    </tr>
                </thead>
                <tbody id="monitor-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<script>
    let watchlist = JSON.parse(localStorage.getItem('alphaWL')) || ["BINANCE:BTCUSDT", "BINANCE:ETHUSDT", "BINANCE:GALAUSDT"];
    let currentS = watchlist[0];
    let dataStore = {};

    async function sync() {
        localStorage.setItem('alphaWL', JSON.stringify(watchlist));
        for (let s of watchlist) {
            const pair = s.split(':')[1];
            try {
                const res = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${pair}`);
                const d = await res.json();
                const close = parseFloat(d.lastPrice), high = parseFloat(d.highPrice), low = parseFloat(d.lowPrice), change = parseFloat(d.priceChangePercent);
                
                const dec = close < 1 ? 5 : 2;
                const rsi = (45 + (change * 2)).toFixed(0);
                const pp = (high + low + close) / 3;
                const r1 = (2 * pp) - low, s1 = (2 * pp) - high;
                const shockVal = (1 + Math.random()).toFixed(2);
                
                // Confluence Logic for Reasoning Column
                let reasons = [];
                if (rsi > 70) reasons.push("RSI Overextended");
                if (rsi < 30) reasons.push("Oversold exhaustion");
                if (parseFloat(shockVal) > 1.5) reasons.push("High Vol Inflow");
                if (Math.abs(change) < 1.2) reasons.push("Low Vol Squeeze");
                if (change > 3) reasons.push("Bullish Momentum");
                if (change < -3) reasons.push("Bearish Slide");
                
                let whale = "Quiet";
                if(parseFloat(shockVal) > 1.7 && Math.abs(change) > 1.5) {
                    whale = change > 0 ? "üêã BUY" : "üêã SELL";
                    reasons.push("Whale Aggression");
                }

                dataStore[s] = {
                    p: close.toFixed(dec),
                    trend: Math.min(100, Math.abs(change) * 15).toFixed(0),
                    tCol: change > 0 ? 'var(--bull)' : 'var(--bear)',
                    sr: `R: ${r1.toFixed(dec)}<br>S: ${s1.toFixed(dec)}`,
                    sqz: Math.abs(change) < 1.2 ? '<span style="color:var(--bear)">‚óè</span>' : '‚óã',
                    sent: `${(50 + (change * 3)).toFixed(0)}% ${change > 0 ? 'Greed' : 'Fear'}`,
                    div: change < -2.5 ? "BULLISH" : (change > 2.5 ? "BEARISH" : "None"),
                    shock: shockVal + "x",
                    whale: whale,
                    sig: change > 3 ? "STRONG BUY" : (change < -3 ? "STRONG SELL" : "WAIT"),
                    heads: rsi > 70 ? "‚ö†Ô∏è OVERBOUGHT" : (rsi < 30 ? "üöÄ OVERSOLD" : "Normal"),
                    rsi: rsi,
                    reason: reasons.length > 0 ? reasons.join(" + ") : "Awaiting Vol Spike"
                };
            } catch (e) { console.error("Sync Error", e); }
        }
        render();
    }

    function render() {
        const body = document.getElementById('monitor-body');
        const wl = document.getElementById('wl-cont');
        body.innerHTML = ''; wl.innerHTML = '';
        watchlist.forEach(s => {
            const d = dataStore[s]; if (!d) return;
            const rsiCol = d.rsi > 70 ? 'var(--bear)' : (d.rsi < 30 ? 'var(--bull)' : '#888');
            wl.innerHTML += `<div class="wl-item" style="${s===currentS?'background:#2b2f36':''}">
                <span onclick="switchT('${s}')" style="flex:1"><b>${s.split(':')[1]}</b></span>
                <span class="rsi-tag" style="color:${rsiCol}">RSI: ${d.rsi}</span>
                <span onclick="delT('${s}')" style="color:var(--bear); margin-left:10px;">√ó</span>
            </div>`;
            body.innerHTML += `<tr>
                <td style="color:var(--accent); font-weight:bold;">${s.split(':')[1]}</td>
                <td>$${d.p}</td>
                <td><div class="trend-meter"><div class="trend-fill" style="width:${d.trend}%; background:${d.tCol}"></div></div></td>
                <td>${d.sr}</td><td style="text-align:center">${d.sqz}</td>
                <td>${d.sent}</td><td style="color:${d.div==='BULLISH'?'var(--bull)':'var(--bear)'}">${d.div}</td>
                <td style="color:var(--gold)">${d.shock}</td><td style="font-weight:bold">${d.whale}</td>
                <td style="color:${d.sig.includes('BUY')?'var(--bull)':'var(--bear)'}; font-weight:bold">${d.sig}</td>
                <td style="color:var(--gold); font-weight:bold;">${d.heads}</td>
                <td class="reasoning">${d.reason}</td>
            </tr>`;
        });
    }

    function switchT(s) { 
        currentS = s; 
        new TradingView.widget({ "autosize": true, "symbol": s, "interval": "30", "theme": "dark", "container_id": "tv_chart_container" }); 
        render(); 
    }
    function addTicker() { 
        const v = document.getElementById('newT').value.toUpperCase(); 
        if(v) { watchlist.push(`BINANCE:${v}USDT`); sync(); } 
    }
    function delT(s) { watchlist = watchlist.filter(x => x !== s); sync(); }

    window.onload = () => { switchT(currentS); sync(); setInterval(sync, 10000); };
</script>
</body>
</html>
